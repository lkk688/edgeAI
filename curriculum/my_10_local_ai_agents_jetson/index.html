
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>🤖 Local AI Agents on Jetson - Jetson Cyber & AI Summer Camp</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#local-ai-agents-on-jetson" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Jetson Cyber &amp; AI Summer Camp" class="md-header__button md-logo" aria-label="Jetson Cyber & AI Summer Camp" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jetson Cyber & AI Summer Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              🤖 Local AI Agents on Jetson
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jetson Cyber &amp; AI Summer Camp" class="md-nav__button md-logo" aria-label="Jetson Cyber & AI Summer Camp" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Jetson Cyber & AI Summer Camp
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00_sjsujetsontool_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sjsujetsontool Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01a_nvidia_jetson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to NVIDIA Jetson
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01b_linux_networking_tools.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Linux and Networking
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core Systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_programming_env_python_cpp_cuda.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming Environment (Python/C++/CUDA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_accelerated_computing_python_cuda.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accelerated Python + CUDA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04a_numpy_pytorch_intro.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Numpy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04b_pytorch_intro.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cyber Systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cyber Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01b_linux_networking_tools.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Networking Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01c_packet_sniffing_monitoring.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Packet Sniffing & Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01d_linux_cyber_defense_basics.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Cyber Defense Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01e_linux_cyber_attack_simulation.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulated Attacks & Detection
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI & LLM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            AI & LLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_cnn_image_processing_jetson.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CNNs + Image Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_transformers_llms_jetson.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformers & LLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_nlp_applications_llm_optimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLP + Inference Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_prompt_engineering_langchain_jetson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompt Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09_rag_app_langchain_jetson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAG Apps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10_local_ai_agents_jetson.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local AI Agents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Final Project
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Final Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11_final_challenges_hackathon.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hackathon & Challenges
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-ai-agents" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 What are AI Agents?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧠 What are AI Agents?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Key Characteristics:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-agent-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Advanced Agent Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔧 Advanced Agent Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      🧩 Core Components:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-sources" class="md-nav__link">
    <span class="md-ellipsis">
      🗄️ Data Sources:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#document-processing-local-search" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Document Processing &amp; Local Search
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Document Processing &amp; Local Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-format-document-support" class="md-nav__link">
    <span class="md-ellipsis">
      🔍 Multi-Format Document Support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-processing-tools-for-agents" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Document Processing Tools for Agents
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-search-online-integration" class="md-nav__link">
    <span class="md-ellipsis">
      🌐 Web Search &amp; Online Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌐 Web Search &amp; Online Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-search-tools" class="md-nav__link">
    <span class="md-ellipsis">
      🔍 Web Search Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hybrid-search-local-web" class="md-nav__link">
    <span class="md-ellipsis">
      🔗 Hybrid Search: Local + Web
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-agent-memory-systems" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 Advanced Agent Memory Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧠 Advanced Agent Memory Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-architecture-for-jetson-agents" class="md-nav__link">
    <span class="md-ellipsis">
      💾 Memory Architecture for Jetson Agents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-enhanced-agent-integration" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 Memory-Enhanced Agent Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jetson-specific-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      ⚡ Jetson-Specific Optimizations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⚡ Jetson-Specific Optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-optimization-for-edge-ai" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Performance Optimization for Edge AI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-acceleration-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Hardware Acceleration Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-context-protocol-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      🔌 Model Context Protocol (MCP) Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔌 Model Context Protocol (MCP) Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-to-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      📋 Introduction to MCP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-architecture-for-jetson" class="md-nav__link">
    <span class="md-ellipsis">
      🏗️ MCP Architecture for Jetson
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-mcp-servers-for-jetson" class="md-nav__link">
    <span class="md-ellipsis">
      🛠️ Building MCP Servers for Jetson
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🛠️ Building MCP Servers for Jetson">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-processing-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      Document Processing MCP Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-based-ai-agent" class="md-nav__link">
    <span class="md-ellipsis">
      🤖 MCP-Based AI Agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-vs-langchain-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 MCP vs LangChain Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-on-jetson" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Deployment on Jetson
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      📊 Performance Comparison
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-calling-support-tool-use-via-json" class="md-nav__link">
    <span class="md-ellipsis">
      🤝 Function Calling Support (Tool Use via JSON)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🤝 Function Calling Support (Tool Use via JSON)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-its-useful" class="md-nav__link">
    <span class="md-ellipsis">
      Why it's useful:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-mcp-multi-component-prompting" class="md-nav__link">
    <span class="md-ellipsis">
      🧰 What is MCP (Multi-Component Prompting)?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-tools" class="md-nav__link">
    <span class="md-ellipsis">
      🔌 Agent Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-types-langchain" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Agent Types (LangChain)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-local-langchain-agent-with-llamacpp-or-ollama" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Lab: Local LangChain Agent with llama.cpp or Ollama
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧪 Lab: Local LangChain Agent with llama.cpp or Ollama">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      🧰 Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llamacpp-backend" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ llama.cpp Backend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ollama-backend-openai-compatible-api" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Ollama Backend (OpenAI-compatible API)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonus-add-filesystem-tool" class="md-nav__link">
    <span class="md-ellipsis">
      🧪 Bonus: Add Filesystem Tool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      📋 Lab Deliverables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      🧠 Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="local-ai-agents-on-jetson">🤖 Local AI Agents on Jetson<a class="headerlink" href="#local-ai-agents-on-jetson" title="Permanent link">&para;</a></h1>
<h2 id="what-are-ai-agents">🧠 What are AI Agents?<a class="headerlink" href="#what-are-ai-agents" title="Permanent link">&para;</a></h2>
<p>AI Agents are autonomous programs that use LLMs to reason, decide, and act based on goals, memory, and tools. They can perceive their environment, make decisions, and take actions to achieve specific objectives.</p>
<h3 id="key-characteristics">🎯 Key Characteristics:<a class="headerlink" href="#key-characteristics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Autonomy</strong>: Operate independently with minimal human intervention</li>
<li><strong>Reactivity</strong>: Respond to environmental changes and user inputs</li>
<li><strong>Proactivity</strong>: Take initiative to achieve goals</li>
<li><strong>Social Ability</strong>: Interact with other agents and humans</li>
<li><strong>Learning</strong>: Improve performance through experience</li>
</ul>
<p>With LangChain and Jetson, we can create sophisticated local agents that:</p>
<ul>
<li><strong>🔒 Privacy-First</strong>: Run entirely offline without internet dependency</li>
<li><strong>⚡ Edge Optimized</strong>: Use llama.cpp/Ollama for efficient language reasoning</li>
<li><strong>🛠️ Multi-Modal</strong>: Process text, PDFs, images, and structured data</li>
<li><strong>🔍 Intelligent Search</strong>: Perform semantic search across local documents</li>
<li><strong>🌐 Web Integration</strong>: Access online information when needed</li>
<li><strong>💾 Persistent Memory</strong>: Maintain context across sessions</li>
<li><strong>🧰 Tool Integration</strong>: Execute code, manage files, and interact with APIs</li>
</ul>
<hr />
<h2 id="advanced-agent-architecture">🔧 Advanced Agent Architecture<a class="headerlink" href="#advanced-agent-architecture" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>graph TD
    A[User Input] --&gt; B[Intent Parser]
    B --&gt; C[Memory Manager]
    C --&gt; D[Planning Engine LLM]
    D --&gt; E[Tool Selector]
    E --&gt; F[Tool Executor]
    F --&gt; G[Result Processor]
    G --&gt; H[Response Generator]
    H --&gt; I[Memory Update]
    I --&gt; J[User Output]

    K[Document Store] --&gt; F
    L[Vector Database] --&gt; F
    M[Web Search API] --&gt; F
    N[File System] --&gt; F
    O[Python REPL] --&gt; F
</code></pre></div>
<h3 id="core-components">🧩 Core Components:<a class="headerlink" href="#core-components" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>🎯 Intent Parser</strong>: Analyzes user input and determines task type</li>
<li><strong>🧠 Memory Manager</strong>: Handles short-term and long-term memory</li>
<li><strong>📋 Planning Engine (LLM)</strong>: Creates execution plans and reasoning chains</li>
<li><strong>🔧 Tool Selector</strong>: Chooses appropriate tools based on context</li>
<li><strong>⚙️ Tool Executor</strong>: Executes selected tools with proper parameters</li>
<li><strong>📊 Result Processor</strong>: Aggregates and validates tool outputs</li>
<li><strong>💬 Response Generator</strong>: Creates human-readable responses</li>
<li><strong>💾 Memory Update</strong>: Stores important information for future use</li>
</ol>
<h3 id="data-sources">🗄️ Data Sources:<a class="headerlink" href="#data-sources" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>📚 Document Store</strong>: Local PDFs, text files, and structured documents</li>
<li><strong>🔍 Vector Database</strong>: Semantic search capabilities</li>
<li><strong>🌐 Web Search</strong>: Online information retrieval</li>
<li><strong>📁 File System</strong>: Direct file operations</li>
<li><strong>🐍 Python Environment</strong>: Code execution and data processing</li>
</ul>
<hr />
<h2 id="document-processing-local-search">📚 Document Processing &amp; Local Search<a class="headerlink" href="#document-processing-local-search" title="Permanent link">&para;</a></h2>
<h3 id="multi-format-document-support">🔍 Multi-Format Document Support<a class="headerlink" href="#multi-format-document-support" title="Permanent link">&para;</a></h3>
<p>Our AI agent can process various document formats locally on Jetson:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Document processing imports</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">PyPDF2</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pdfplumber</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Install PDF libraries: pip install PyPDF2 pdfplumber&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">docx</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span> <span class="k">as</span> <span class="n">DocxDocument</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Install docx: pip install python-docx&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Install pandas: pip install pandas&quot;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.document_loaders</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PyPDFLoader</span><span class="p">,</span>
    <span class="n">TextLoader</span><span class="p">,</span>
    <span class="n">CSVLoader</span><span class="p">,</span>
    <span class="n">JSONLoader</span><span class="p">,</span>
    <span class="n">DirectoryLoader</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.text_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SentenceTransformerEmbeddings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.vectorstores</span><span class="w"> </span><span class="kn">import</span> <span class="n">FAISS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JetsonDocumentProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimized document processing for Jetson platforms&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embedding_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">SentenceTransformerEmbeddings</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">embedding_model</span><span class="p">,</span>
            <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_splitter</span> <span class="o">=</span> <span class="n">RecursiveCharacterTextSplitter</span><span class="p">(</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">separators</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_pdf_advanced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Advanced PDF processing with metadata extraction&quot;&quot;&quot;</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Method 1: PyPDF2 for basic extraction</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">pdf_reader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">pdf_reader</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pdf_reader</span><span class="o">.</span><span class="n">pages</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">extract_text</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
                            <span class="n">page_content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="p">,</span>
                                <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                                <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/Author&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyPDF2 failed for </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Fallback: pdfplumber for better text extraction</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">pdfplumber</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">pages</span><span class="p">):</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">extract_text</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                            <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
                                <span class="n">page_content</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">pdf_path</span><span class="p">,</span>
                                    <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;extraction_method&quot;</span><span class="p">:</span> <span class="s2">&quot;pdfplumber&quot;</span>
                                <span class="p">}</span>
                            <span class="p">)</span>
                            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pdfplumber also failed for </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load all supported documents from directory&quot;&quot;&quot;</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>

        <span class="c1"># Supported file extensions</span>
        <span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_pdf_advanced</span><span class="p">,</span>
            <span class="s1">&#39;.txt&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">page_content</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> 
                                      <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">})],</span>
            <span class="s1">&#39;.md&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">page_content</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> 
                                     <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;markdown&quot;</span><span class="p">})],</span>
            <span class="s1">&#39;.json&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json</span><span class="p">,</span>
            <span class="s1">&#39;.csv&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_csv</span><span class="p">,</span>
            <span class="s1">&#39;.docx&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_docx</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">loaders</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">file_docs</span> <span class="o">=</span> <span class="n">loaders</span><span class="p">[</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()](</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                    <span class="n">documents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">file_docs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load JSON files&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
                    <span class="n">page_content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">documents</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span>
                <span class="n">page_content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">}</span>
            <span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load CSV files&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Convert each row to a document</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
                <span class="n">page_content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;row&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;csv&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_docx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load DOCX files&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">DocxDocument</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">paragraph</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span>
                <span class="n">page_content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;docx&quot;</span><span class="p">}</span>
            <span class="p">)]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading DOCX </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_vectorstore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">FAISS</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build FAISS vectorstore for semantic search&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">documents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No documents provided&quot;</span><span class="p">)</span>

        <span class="c1"># Split documents into chunks</span>
        <span class="n">split_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_splitter</span><span class="o">.</span><span class="n">split_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Split </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents into </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">split_docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks&quot;</span><span class="p">)</span>

        <span class="c1"># Create vectorstore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">FAISS</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">split_docs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span> <span class="o">=</span> <span class="n">split_docs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Document</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Semantic search across documents&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vectorstore not built. Call build_vectorstore first.&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">similarity_search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_vectorstore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save vectorstore to disk&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span><span class="o">.</span><span class="n">save_local</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_vectorstore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load vectorstore from disk&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">FAISS</span><span class="o">.</span><span class="n">load_local</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Usage example</span>
<span class="n">doc_processor</span> <span class="o">=</span> <span class="n">JetsonDocumentProcessor</span><span class="p">()</span>

<span class="c1"># Load documents from directory</span>
<span class="n">documents</span> <span class="o">=</span> <span class="n">doc_processor</span><span class="o">.</span><span class="n">load_directory</span><span class="p">(</span><span class="s2">&quot;./documents&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>

<span class="c1"># Build vectorstore for semantic search</span>
<span class="n">vectorstore</span> <span class="o">=</span> <span class="n">doc_processor</span><span class="o">.</span><span class="n">build_vectorstore</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

<span class="c1"># Search documents</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">doc_processor</span><span class="o">.</span><span class="n">search_documents</span><span class="p">(</span><span class="s2">&quot;machine learning optimization&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="document-processing-tools-for-agents">🔧 Document Processing Tools for Agents<a class="headerlink" href="#document-processing-tools-for-agents" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DocumentSearchTool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tool for semantic document search&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_processor</span><span class="p">:</span> <span class="n">JetsonDocumentProcessor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_processor</span> <span class="o">=</span> <span class="n">doc_processor</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search documents and return formatted results&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_processor</span><span class="o">.</span><span class="n">search_documents</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">num_results</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;No documents found for query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">formatted_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">page_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (Page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">page</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">[:</span><span class="mi">300</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">300</span> <span class="k">else</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_content</span>

                <span class="n">formatted_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Result </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">source</span><span class="si">}{</span><span class="n">page_info</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_results</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error searching documents: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_document_tools</span><span class="p">(</span><span class="n">doc_processor</span><span class="p">:</span> <span class="n">JetsonDocumentProcessor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create document-related tools for the agent&quot;&quot;&quot;</span>
    <span class="n">search_tool</span> <span class="o">=</span> <span class="n">DocumentSearchTool</span><span class="p">(</span><span class="n">doc_processor</span><span class="p">)</span>

    <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Tool</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;search_documents&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="n">search_tool</span><span class="o">.</span><span class="n">search</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search through local documents using semantic similarity. &quot;</span>
                       <span class="s2">&quot;Input should be a search query string. Returns relevant document excerpts.&quot;</span>
        <span class="p">),</span>
        <span class="n">Tool</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;list_document_sources&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> 
                                       <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_processor</span><span class="o">.</span><span class="n">documents</span><span class="p">)),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List all available document sources in the knowledge base.&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">tools</span>
</code></pre></div>
<hr />
<h2 id="web-search-online-integration">🌐 Web Search &amp; Online Integration<a class="headerlink" href="#web-search-online-integration" title="Permanent link">&para;</a></h2>
<h3 id="web-search-tools">🔍 Web Search Tools<a class="headerlink" href="#web-search-tools" title="Permanent link">&para;</a></h3>
<p>Integrate web search capabilities for real-time information retrieval:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">quote_plus</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">GoogleSearchAPIWrapper</span><span class="p">,</span> <span class="n">DuckDuckGoSearchAPIWrapper</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JetsonWebSearchTool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimized web search for Jetson with multiple search engines&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;duckduckgo&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_engine</span> <span class="o">=</span> <span class="n">search_engine</span>

        <span class="k">if</span> <span class="n">search_engine</span> <span class="o">==</span> <span class="s2">&quot;google&quot;</span><span class="p">:</span>
            <span class="c1"># Requires GOOGLE_API_KEY and GOOGLE_CSE_ID environment variables</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">google_search</span> <span class="o">=</span> <span class="n">GoogleSearchAPIWrapper</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Google Search setup failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">google_search</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">search_engine</span> <span class="o">==</span> <span class="s2">&quot;duckduckgo&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ddg_search</span> <span class="o">=</span> <span class="n">DuckDuckGoSearchAPIWrapper</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_web</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search the web and return formatted results&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_engine</span> <span class="o">==</span> <span class="s2">&quot;google&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">google_search</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">google_search</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_google_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">num_results</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_engine</span> <span class="o">==</span> <span class="s2">&quot;duckduckgo&quot;</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddg_search</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_ddg_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">num_results</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">num_results</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Web search error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_google_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_results</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format Google search results&quot;&quot;&quot;</span>
        <span class="c1"># Google API returns formatted string, parse and limit</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">limited_results</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="n">num_results</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># Approximate 3 lines per result</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">limited_results</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_ddg_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_results</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format DuckDuckGo search results&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">results</span>  <span class="c1"># DuckDuckGo wrapper already formats results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fallback_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_results</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fallback search using direct HTTP requests&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Simple DuckDuckGo instant answer API</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.duckduckgo.com/?q=</span><span class="si">{</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;format=json&amp;no_html=1&amp;skip_disambig=1&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="n">result_text</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Abstract (instant answer)</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Abstract&#39;</span><span class="p">):</span>
                <span class="n">result_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summary: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Abstract&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbstractURL&#39;</span><span class="p">):</span>
                    <span class="n">result_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AbstractURL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Related topics</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelatedTopics&#39;</span><span class="p">):</span>
                <span class="n">result_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Related Information:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RelatedTopics&#39;</span><span class="p">][:</span><span class="n">num_results</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Text&#39;</span> <span class="ow">in</span> <span class="n">topic</span><span class="p">:</span>
                        <span class="n">result_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">topic</span><span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s1">&#39;FirstURL&#39;</span> <span class="ow">in</span> <span class="n">topic</span><span class="p">:</span>
                            <span class="n">result_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   URL: </span><span class="si">{</span><span class="n">topic</span><span class="p">[</span><span class="s1">&#39;FirstURL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_text</span><span class="p">)</span> <span class="k">if</span> <span class="n">result_text</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;No results found for: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fallback search failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WebContentExtractor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract and summarize web page content&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#39;</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract main content from a web page&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

            <span class="c1"># Remove script and style elements</span>
            <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">]):</span>
                <span class="n">script</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>

            <span class="c1"># Try to find main content areas</span>
            <span class="n">content_selectors</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;article&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;.content&#39;</span><span class="p">,</span> <span class="s1">&#39;#content&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.post-content&#39;</span><span class="p">,</span> <span class="s1">&#39;.entry-content&#39;</span><span class="p">,</span> <span class="s1">&#39;.article-content&#39;</span>
            <span class="p">]</span>

            <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">content_selectors</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">elem</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">])</span>
                    <span class="k">break</span>

            <span class="c1"># Fallback to body content</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">if</span> <span class="n">body</span> <span class="k">else</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

            <span class="c1"># Clean and truncate</span>
            <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>  <span class="c1"># Remove extra whitespace</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[:</span><span class="n">max_length</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Content from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error extracting content from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_web_search_tools</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create web search and content extraction tools&quot;&quot;&quot;</span>
    <span class="n">web_search</span> <span class="o">=</span> <span class="n">JetsonWebSearchTool</span><span class="p">(</span><span class="s2">&quot;duckduckgo&quot;</span><span class="p">)</span>
    <span class="n">content_extractor</span> <span class="o">=</span> <span class="n">WebContentExtractor</span><span class="p">()</span>

    <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Tool</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;web_search&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">query</span><span class="p">:</span> <span class="n">web_search</span><span class="o">.</span><span class="n">search_web</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search the web for current information. &quot;</span>
                       <span class="s2">&quot;Input should be a search query string. Returns web search results.&quot;</span>
        <span class="p">),</span>
        <span class="n">Tool</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;extract_web_content&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> <span class="n">content_extractor</span><span class="o">.</span><span class="n">extract_content</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1500</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extract and summarize content from a web page. &quot;</span>
                       <span class="s2">&quot;Input should be a valid URL. Returns the main content of the page.&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">tools</span>

<span class="c1"># Usage example</span>
<span class="n">web_tools</span> <span class="o">=</span> <span class="n">create_web_search_tools</span><span class="p">()</span>

<span class="c1"># Test web search</span>
<span class="n">search_result</span> <span class="o">=</span> <span class="n">web_tools</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="s2">&quot;latest NVIDIA Jetson updates 2024&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Search Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">search_result</span><span class="p">)</span>
</code></pre></div>
<h3 id="hybrid-search-local-web">🔗 Hybrid Search: Local + Web<a class="headerlink" href="#hybrid-search-local-web" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HybridSearchAgent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent that combines local document search with web search&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_processor</span><span class="p">:</span> <span class="n">JetsonDocumentProcessor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_processor</span> <span class="o">=</span> <span class="n">doc_processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_search</span> <span class="o">=</span> <span class="n">JetsonWebSearchTool</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_extractor</span> <span class="o">=</span> <span class="n">WebContentExtractor</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intelligent_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">search_local</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">search_web</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform intelligent search across local and web sources&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s2">&quot;local_results&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;web_results&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">}</span>

        <span class="c1"># Local document search</span>
        <span class="k">if</span> <span class="n">search_local</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_processor</span><span class="o">.</span><span class="n">vectorstore</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">local_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_processor</span><span class="o">.</span><span class="n">search_documents</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;local_results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">),</span>
                        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">[:</span><span class="mi">300</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">300</span> <span class="k">else</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">,</span>
                        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">local_docs</span>
                <span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;local_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Web search</span>
        <span class="k">if</span> <span class="n">search_web</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">web_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_search</span><span class="o">.</span><span class="n">search_web</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;web_results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">web_content</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;web_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Generate summary</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_search_summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_search_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a summary of search results&quot;&quot;&quot;</span>
        <span class="n">summary_parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;local_results&quot;</span><span class="p">]:</span>
            <span class="n">summary_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;local_results&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> relevant local documents.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;web_results&quot;</span><span class="p">]:</span>
            <span class="n">summary_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Retrieved current web information.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">summary_parts</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No results found from local or web sources.&quot;</span>

        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_parts</span><span class="p">)</span>

<span class="c1"># Create hybrid search tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_hybrid_search_tool</span><span class="p">(</span><span class="n">doc_processor</span><span class="p">:</span> <span class="n">JetsonDocumentProcessor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a hybrid search tool that combines local and web search&quot;&quot;&quot;</span>
    <span class="n">hybrid_agent</span> <span class="o">=</span> <span class="n">HybridSearchAgent</span><span class="p">(</span><span class="n">doc_processor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hybrid_search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">hybrid_agent</span><span class="o">.</span><span class="n">intelligent_search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="n">formatted_output</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Search Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="c1"># Local results</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;local_results&quot;</span><span class="p">]:</span>
            <span class="n">formatted_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;📚 Local Documents:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;local_results&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">formatted_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">formatted_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Web results</span>
        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;web_results&quot;</span><span class="p">]:</span>
            <span class="n">formatted_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;🌐 Web Results:&quot;</span><span class="p">)</span>
            <span class="n">formatted_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;web_results&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_output</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hybrid_search&quot;</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">hybrid_search</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search both local documents and the web for comprehensive information. &quot;</span>
                   <span class="s2">&quot;Input should be a search query string. Returns combined local and web results.&quot;</span>
    <span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="advanced-agent-memory-systems">🧠 Advanced Agent Memory Systems<a class="headerlink" href="#advanced-agent-memory-systems" title="Permanent link">&para;</a></h2>
<h3 id="memory-architecture-for-jetson-agents">💾 Memory Architecture for Jetson Agents<a class="headerlink" href="#memory-architecture-for-jetson-agents" title="Permanent link">&para;</a></h3>
<p>Implement sophisticated memory systems to improve agent performance and context retention:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConversationBufferMemory</span><span class="p">,</span> <span class="n">ConversationSummaryMemory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseMessage</span><span class="p">,</span> <span class="n">HumanMessage</span><span class="p">,</span> <span class="n">AIMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.embeddings</span><span class="w"> </span><span class="kn">import</span> <span class="n">SentenceTransformerEmbeddings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.vectorstores</span><span class="w"> </span><span class="kn">import</span> <span class="n">FAISS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MemoryEntry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structure for memory entries&quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># &#39;conversation&#39;, &#39;fact&#39;, &#39;preference&#39;, &#39;task&#39;</span>
    <span class="n">importance</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># 0.0 to 1.0</span>
    <span class="n">embedding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JetsonMemoryManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Advanced memory management system for Jetson AI agents&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;agent_memory.db&quot;</span><span class="p">,</span> <span class="n">embedding_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all-MiniLM-L6-v2&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">SentenceTransformerEmbeddings</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">embedding_model</span><span class="p">,</span>
            <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Initialize database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_database</span><span class="p">()</span>

        <span class="c1"># Memory components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_term_memory</span> <span class="o">=</span> <span class="n">ConversationBufferMemory</span><span class="p">(</span>
            <span class="n">memory_key</span><span class="o">=</span><span class="s2">&quot;chat_history&quot;</span><span class="p">,</span>
            <span class="n">return_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">max_token_limit</span><span class="o">=</span><span class="mi">2000</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">episodic_memory</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Recent conversations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Long-term knowledge vectorstore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">working_memory</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Current task context</span>

        <span class="c1"># Load existing semantic memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_semantic_memory</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize SQLite database for persistent memory&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            CREATE TABLE IF NOT EXISTS memory_entries (</span>
<span class="s1">                id TEXT PRIMARY KEY,</span>
<span class="s1">                timestamp TEXT,</span>
<span class="s1">                content TEXT,</span>
<span class="s1">                memory_type TEXT,</span>
<span class="s1">                importance REAL,</span>
<span class="s1">                embedding BLOB,</span>
<span class="s1">                metadata TEXT</span>
<span class="s1">            )</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            CREATE TABLE IF NOT EXISTS user_preferences (</span>
<span class="s1">                key TEXT PRIMARY KEY,</span>
<span class="s1">                value TEXT,</span>
<span class="s1">                timestamp TEXT</span>
<span class="s1">            )</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            CREATE TABLE IF NOT EXISTS conversation_history (</span>
<span class="s1">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">                session_id TEXT,</span>
<span class="s1">                timestamp TEXT,</span>
<span class="s1">                role TEXT,</span>
<span class="s1">                content TEXT,</span>
<span class="s1">                metadata TEXT</span>
<span class="s1">            )</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">importance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new memory entry&quot;&quot;&quot;</span>
        <span class="n">entry_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">hash</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10000</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Generate embedding</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Create memory entry</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">MemoryEntry</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">entry_id</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">importance</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span>
            <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>

        <span class="c1"># Store in database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            INSERT INTO memory_entries (id, timestamp, content, memory_type, importance, embedding, metadata)</span>
<span class="s1">            VALUES (?, ?, ?, ?, ?, ?, ?)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">importance</span><span class="p">,</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">embedding</span><span class="p">),</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># Update semantic memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_semantic_memory</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entry_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">retrieve_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">min_importance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MemoryEntry</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve relevant memories using semantic search&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Semantic search</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">similar_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span><span class="o">.</span><span class="n">similarity_search_by_vector</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Filter and rank results</span>
        <span class="n">relevant_memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">similar_docs</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span>

            <span class="c1"># Filter by memory type</span>
            <span class="k">if</span> <span class="n">memory_types</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;memory_type&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">memory_types</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Filter by importance</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_importance</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Reconstruct memory entry</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">MemoryEntry</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]),</span>
                <span class="n">content</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">,</span>
                <span class="n">memory_type</span><span class="o">=</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;memory_type&#39;</span><span class="p">],</span>
                <span class="n">importance</span><span class="o">=</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;importance&#39;</span><span class="p">],</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extra_metadata&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="p">)</span>
            <span class="n">relevant_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="c1"># Sort by importance and recency</span>
        <span class="n">relevant_memories</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">importance</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">timestamp</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">relevant_memories</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_semantic_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="n">MemoryEntry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the semantic memory vectorstore&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">langchain.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>

        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
            <span class="n">page_content</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;memory_type&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">memory_type</span><span class="p">,</span>
                <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">importance</span><span class="p">,</span>
                <span class="s1">&#39;extra_metadata&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">metadata</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span> <span class="o">=</span> <span class="n">FAISS</span><span class="o">.</span><span class="n">from_documents</span><span class="p">([</span><span class="n">doc</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span><span class="o">.</span><span class="n">add_documents</span><span class="p">([</span><span class="n">doc</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_semantic_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load existing memories into semantic memory&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM memory_entries&#39;</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
                <span class="n">page_content</span><span class="o">=</span><span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="c1"># content</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;memory_type&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                    <span class="s1">&#39;extra_metadata&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">else</span> <span class="p">{}</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">documents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span> <span class="o">=</span> <span class="n">FAISS</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_conversation_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">human_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ai_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update conversation memory with new exchange&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Add to short-term memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_term_memory</span><span class="o">.</span><span class="n">chat_memory</span><span class="o">.</span><span class="n">add_user_message</span><span class="p">(</span><span class="n">human_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_term_memory</span><span class="o">.</span><span class="n">chat_memory</span><span class="o">.</span><span class="n">add_ai_message</span><span class="p">(</span><span class="n">ai_message</span><span class="p">)</span>

        <span class="c1"># Store in database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            INSERT INTO conversation_history (session_id, timestamp, role, content, metadata)</span>
<span class="s1">            VALUES (?, ?, ?, ?, ?)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">session_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;human&#39;</span><span class="p">,</span> <span class="n">human_message</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            INSERT INTO conversation_history (session_id, timestamp, role, content, metadata)</span>
<span class="s1">            VALUES (?, ?, ?, ?, ?)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">session_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="n">ai_message</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># Add to episodic memory if important</span>
        <span class="n">conversation_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Human: </span><span class="si">{</span><span class="n">human_message</span><span class="si">}</span><span class="se">\n</span><span class="s2">AI: </span><span class="si">{</span><span class="n">ai_message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_importance</span><span class="p">(</span><span class="n">conversation_text</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">importance</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># Threshold for storing in long-term memory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">conversation_text</span><span class="p">,</span>
                <span class="n">memory_type</span><span class="o">=</span><span class="s2">&quot;conversation&quot;</span><span class="p">,</span>
                <span class="n">importance</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;session_id&quot;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">}</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate importance score for memory content&quot;&quot;&quot;</span>
        <span class="n">importance_keywords</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;important&#39;</span><span class="p">,</span> <span class="s1">&#39;remember&#39;</span><span class="p">,</span> <span class="s1">&#39;preference&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;dislike&#39;</span><span class="p">,</span>
            <span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="s1">&#39;never&#39;</span><span class="p">,</span> <span class="s1">&#39;favorite&#39;</span><span class="p">,</span> <span class="s1">&#39;hate&#39;</span><span class="p">,</span> <span class="s1">&#39;love&#39;</span><span class="p">,</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
            <span class="s1">&#39;urgent&#39;</span><span class="p">,</span> <span class="s1">&#39;deadline&#39;</span><span class="p">,</span> <span class="s1">&#39;appointment&#39;</span><span class="p">,</span> <span class="s1">&#39;meeting&#39;</span>
        <span class="p">]</span>

        <span class="n">content_lower</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">keyword_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">importance_keywords</span> <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">content_lower</span><span class="p">)</span>

        <span class="c1"># Normalize score</span>
        <span class="n">base_importance</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keyword_score</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

        <span class="c1"># Add length factor (longer conversations might be more important)</span>
        <span class="n">length_factor</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_importance</span> <span class="o">+</span> <span class="n">length_factor</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_for_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_context_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get relevant context for a query from all memory sources&quot;&quot;&quot;</span>
        <span class="n">context_parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get relevant memories</span>
        <span class="n">relevant_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_memories</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relevant_memories</span><span class="p">:</span>
            <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Relevant memories:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">relevant_memories</span><span class="p">:</span>
                <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># Get recent conversation context</span>
        <span class="n">recent_messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_term_memory</span><span class="o">.</span><span class="n">chat_memory</span><span class="o">.</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>  <span class="c1"># Last 2 exchanges</span>
        <span class="k">if</span> <span class="n">recent_messages</span><span class="p">:</span>
            <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recent conversation:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">recent_messages</span><span class="p">:</span>
                <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;Human&quot;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">HumanMessage</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;AI&quot;</span>
                <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">150</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># Combine and truncate context</span>
        <span class="n">full_context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_parts</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_context</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_context_length</span><span class="p">:</span>
            <span class="n">full_context</span> <span class="o">=</span> <span class="n">full_context</span><span class="p">[:</span><span class="n">max_context_length</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

        <span class="k">return</span> <span class="n">full_context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_user_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save user preference&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            INSERT OR REPLACE INTO user_preferences (key, value, timestamp)</span>
<span class="s1">            VALUES (?, ?, ?)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># Also add to semantic memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User preference: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="s2">&quot;preference&quot;</span><span class="p">,</span>
            <span class="n">importance</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;preference_key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get user preference&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT value FROM user_preferences WHERE key = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_old_memories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days_to_keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up old, low-importance memories&quot;&quot;&quot;</span>
        <span class="n">cutoff_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_to_keep</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            DELETE FROM memory_entries </span>
<span class="s1">            WHERE timestamp &lt; ? AND importance &lt; 0.5</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">cutoff_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            DELETE FROM conversation_history </span>
<span class="s1">            WHERE timestamp &lt; ?</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">cutoff_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c1"># Rebuild semantic memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semantic_memory</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_semantic_memory</span><span class="p">()</span>

<span class="c1"># Usage example</span>
<span class="n">memory_manager</span> <span class="o">=</span> <span class="n">JetsonMemoryManager</span><span class="p">()</span>

<span class="c1"># Add some memories</span>
<span class="n">memory_manager</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
    <span class="s2">&quot;User prefers concise explanations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;preference&quot;</span><span class="p">,</span>
    <span class="n">importance</span><span class="o">=</span><span class="mf">0.9</span>
<span class="p">)</span>

<span class="n">memory_manager</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
    <span class="s2">&quot;Discussed machine learning optimization techniques for Jetson&quot;</span><span class="p">,</span>
    <span class="s2">&quot;conversation&quot;</span><span class="p">,</span>
    <span class="n">importance</span><span class="o">=</span><span class="mf">0.7</span>
<span class="p">)</span>

<span class="c1"># Retrieve relevant memories</span>
<span class="n">relevant</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">retrieve_memories</span><span class="p">(</span><span class="s2">&quot;optimization techniques&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2"> (Importance: </span><span class="si">{</span><span class="n">memory</span><span class="o">.</span><span class="n">importance</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="memory-enhanced-agent-integration">🔄 Memory-Enhanced Agent Integration<a class="headerlink" href="#memory-enhanced-agent-integration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemoryEnhancedAgent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AI Agent with advanced memory capabilities&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">:</span> <span class="n">JetsonMemoryManager</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="n">memory_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tool</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversation_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process user query with memory-enhanced context&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversation_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Get relevant context from memory</span>
        <span class="n">memory_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_context_for_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Enhance prompt with memory context</span>
        <span class="n">enhanced_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are an AI assistant with access to conversation history and relevant memories.</span>

<span class="s2">Relevant Context:</span>
<span class="si">{</span><span class="n">memory_context</span><span class="si">}</span>

<span class="s2">Current Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">Please provide a helpful response. If you need to use tools, specify which tool and provide the input.</span>
<span class="s2">Available tools: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span>

<span class="s2">Response:&quot;&quot;&quot;</span>

        <span class="c1"># Get LLM response</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">enhanced_prompt</span><span class="p">)</span>

        <span class="c1"># Check if tool use is needed</span>
        <span class="n">tool_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_tool_use</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tool_response</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">tool_response</span>

        <span class="c1"># Update memory with this conversation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">update_conversation_memory</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>

        <span class="c1"># Extract and store any new facts or preferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_and_store_information</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_tool_use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">original_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle tool usage based on LLM response&quot;&quot;&quot;</span>
        <span class="c1"># Simple tool detection (in practice, use more sophisticated parsing)</span>
        <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">tool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">tool_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Extract input for tool (simplified)</span>
                    <span class="n">tool_input</span> <span class="o">=</span> <span class="n">original_query</span>  <span class="c1"># In practice, extract specific input</span>
                    <span class="n">tool_result</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">tool_input</span><span class="p">)</span>

                    <span class="c1"># Generate final response with tool result</span>
                    <span class="n">final_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Original query: </span><span class="si">{</span><span class="n">original_query</span><span class="si">}</span>
<span class="s2">Tool used: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span>
<span class="s2">Tool result: </span><span class="si">{</span><span class="n">tool_result</span><span class="si">}</span>

<span class="s2">Please provide a comprehensive response based on the tool result:&quot;&quot;&quot;</span>

                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">final_prompt</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error using </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_and_store_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract and store important information from conversation&quot;&quot;&quot;</span>
        <span class="c1"># Look for user preferences</span>
        <span class="n">preference_indicators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;i prefer&#39;</span><span class="p">,</span> <span class="s1">&#39;i like&#39;</span><span class="p">,</span> <span class="s1">&#39;i want&#39;</span><span class="p">,</span> <span class="s1">&#39;i need&#39;</span><span class="p">,</span> <span class="s1">&#39;i always&#39;</span><span class="p">,</span> <span class="s1">&#39;i never&#39;</span><span class="p">]</span>
        <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">preference_indicators</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">query_lower</span><span class="p">:</span>
                <span class="c1"># Extract preference (simplified)</span>
                <span class="n">preference_text</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="n">query_lower</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">indicator</span><span class="p">):]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User stated: </span><span class="si">{</span><span class="n">preference_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">memory_type</span><span class="o">=</span><span class="s2">&quot;preference&quot;</span><span class="p">,</span>
                    <span class="n">importance</span><span class="o">=</span><span class="mf">0.8</span>
                <span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Store important facts mentioned in response</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;important&#39;</span><span class="p">,</span> <span class="s1">&#39;remember&#39;</span><span class="p">,</span> <span class="s1">&#39;note that&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Important information: </span><span class="si">{</span><span class="n">response</span><span class="p">[:</span><span class="mi">300</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">memory_type</span><span class="o">=</span><span class="s2">&quot;fact&quot;</span><span class="p">,</span>
                <span class="n">importance</span><span class="o">=</span><span class="mf">0.7</span>
            <span class="p">)</span>

<span class="c1"># Create memory-enhanced agent</span>
<span class="n">memory_manager</span> <span class="o">=</span> <span class="n">JetsonMemoryManager</span><span class="p">()</span>
<span class="n">doc_processor</span> <span class="o">=</span> <span class="n">JetsonDocumentProcessor</span><span class="p">()</span>  <span class="c1"># From previous section</span>

<span class="c1"># Combine all tools</span>
<span class="n">all_tools</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">create_document_tools</span><span class="p">(</span><span class="n">doc_processor</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">create_web_search_tools</span><span class="p">()</span> <span class="o">+</span>
    <span class="p">[</span><span class="n">create_hybrid_search_tool</span><span class="p">(</span><span class="n">doc_processor</span><span class="p">)]</span>
<span class="p">)</span>

<span class="c1"># Create the agent</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">MemoryEnhancedAgent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>  <span class="c1"># Your LLM instance</span>
    <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">all_tools</span>
<span class="p">)</span>

<span class="c1"># Example conversation</span>
<span class="n">response1</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">process_query</span><span class="p">(</span><span class="s2">&quot;I prefer concise explanations. Can you search for Jetson optimization techniques?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response1</span><span class="p">)</span>

<span class="n">response2</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">process_query</span><span class="p">(</span><span class="s2">&quot;What did we discuss about optimization earlier?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response2</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="jetson-specific-optimizations">⚡ Jetson-Specific Optimizations<a class="headerlink" href="#jetson-specific-optimizations" title="Permanent link">&para;</a></h2>
<h3 id="performance-optimization-for-edge-ai">🚀 Performance Optimization for Edge AI<a class="headerlink" href="#performance-optimization-for-edge-ai" title="Permanent link">&para;</a></h3>
<p>Optimize AI agents for Jetson's unique hardware constraints and capabilities:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JetsonSystemInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;System information for Jetson optimization&quot;&quot;&quot;</span>
    <span class="n">gpu_memory_total</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">gpu_memory_free</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">cpu_usage</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">memory_usage</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">power_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">jetson_model</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JetsonOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimization utilities for Jetson AI agents&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimization_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_optimal_settings</span><span class="p">()</span>

        <span class="c1"># Performance monitoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_active</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Memory management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_threshold</span> <span class="o">=</span> <span class="mf">0.85</span>  <span class="c1"># 85% memory usage threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_interval</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes</span>

        <span class="c1"># Start background monitoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_monitoring</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JetsonSystemInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current Jetson system information&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># GPU memory info</span>
            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="n">gpu_memory_total</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_properties</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">total_memory</span>
                <span class="n">gpu_memory_free</span> <span class="o">=</span> <span class="n">gpu_memory_total</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">memory_allocated</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gpu_memory_total</span> <span class="o">=</span> <span class="n">gpu_memory_free</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># CPU and system memory</span>
            <span class="n">cpu_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">memory_info</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
            <span class="n">memory_usage</span> <span class="o">=</span> <span class="n">memory_info</span><span class="o">.</span><span class="n">percent</span> <span class="o">/</span> <span class="mf">100.0</span>

            <span class="c1"># Temperature (Jetson-specific)</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_temperature</span><span class="p">()</span>

            <span class="c1"># Power mode</span>
            <span class="n">power_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_power_mode</span><span class="p">()</span>

            <span class="c1"># Jetson model detection</span>
            <span class="n">jetson_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_jetson_model</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">JetsonSystemInfo</span><span class="p">(</span>
                <span class="n">gpu_memory_total</span><span class="o">=</span><span class="n">gpu_memory_total</span><span class="p">,</span>
                <span class="n">gpu_memory_free</span><span class="o">=</span><span class="n">gpu_memory_free</span><span class="p">,</span>
                <span class="n">cpu_usage</span><span class="o">=</span><span class="n">cpu_usage</span><span class="p">,</span>
                <span class="n">memory_usage</span><span class="o">=</span><span class="n">memory_usage</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
                <span class="n">power_mode</span><span class="o">=</span><span class="n">power_mode</span><span class="p">,</span>
                <span class="n">jetson_model</span><span class="o">=</span><span class="n">jetson_model</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting system info: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">JetsonSystemInfo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Jetson temperature&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try different temperature sensors</span>
            <span class="n">temp_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;/sys/class/thermal/thermal_zone0/temp&#39;</span><span class="p">,</span>
                <span class="s1">&#39;/sys/class/thermal/thermal_zone1/temp&#39;</span><span class="p">,</span>
                <span class="s1">&#39;/sys/devices/virtual/thermal/thermal_zone0/temp&#39;</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">temp_file</span> <span class="ow">in</span> <span class="n">temp_files</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">/</span> <span class="mf">1000.0</span>  <span class="c1"># Convert from millicelsius</span>
                        <span class="k">return</span> <span class="n">temp</span>
                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_power_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current Jetson power mode&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;nvpmodel&#39;</span><span class="p">,</span> <span class="s1">&#39;-q&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s1">&#39;NV Power Mode&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_jetson_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect Jetson model&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/device-tree/model&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">model_info</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s1">&#39;Orin&#39;</span> <span class="ow">in</span> <span class="n">model_info</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;Jetson Orin&#39;</span>
                <span class="k">elif</span> <span class="s1">&#39;Xavier&#39;</span> <span class="ow">in</span> <span class="n">model_info</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;Jetson Xavier&#39;</span>
                <span class="k">elif</span> <span class="s1">&#39;Nano&#39;</span> <span class="ow">in</span> <span class="n">model_info</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;Jetson Nano&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">model_info</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_optimal_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get optimal settings based on Jetson model&quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="o">.</span><span class="n">jetson_model</span>

        <span class="k">if</span> <span class="s1">&#39;Orin&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;max_batch_size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;embedding_batch_size&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
                <span class="s1">&#39;max_workers&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;memory_map_threshold&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                <span class="s1">&#39;gpu_memory_fraction&#39;</span><span class="p">:</span> <span class="mf">0.8</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="s1">&#39;Xavier&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;max_batch_size&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;embedding_batch_size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                <span class="s1">&#39;max_workers&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;memory_map_threshold&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
                <span class="s1">&#39;gpu_memory_fraction&#39;</span><span class="p">:</span> <span class="mf">0.7</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Nano or other</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;max_batch_size&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;embedding_batch_size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;max_workers&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;memory_map_threshold&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
                <span class="s1">&#39;gpu_memory_fraction&#39;</span><span class="p">:</span> <span class="mf">0.6</span>
            <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">optimize_torch_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optimize PyTorch settings for Jetson&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="c1"># Set memory fraction</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_per_process_memory_fraction</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimization_settings</span><span class="p">[</span><span class="s1">&#39;gpu_memory_fraction&#39;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Enable memory mapping for large models</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">matmul</span><span class="o">.</span><span class="n">allow_tf32</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">allow_tf32</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Optimize for inference</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimized PyTorch for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="o">.</span><span class="n">jetson_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_start_monitoring</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start background system monitoring&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">monitor</span><span class="p">():</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_active</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">current_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_info</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                        <span class="s1">&#39;cpu_usage&#39;</span><span class="p">:</span> <span class="n">current_info</span><span class="o">.</span><span class="n">cpu_usage</span><span class="p">,</span>
                        <span class="s1">&#39;memory_usage&#39;</span><span class="p">:</span> <span class="n">current_info</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">,</span>
                        <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">current_info</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
                        <span class="s1">&#39;gpu_memory_free&#39;</span><span class="p">:</span> <span class="n">current_info</span><span class="o">.</span><span class="n">gpu_memory_free</span>
                    <span class="p">})</span>

                    <span class="c1"># Keep only last 100 entries</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]</span>

                    <span class="c1"># Check for thermal throttling</span>
                    <span class="k">if</span> <span class="n">current_info</span><span class="o">.</span><span class="n">temperature</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>  <span class="c1"># 80°C threshold</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ High temperature detected: </span><span class="si">{</span><span class="n">current_info</span><span class="o">.</span><span class="n">temperature</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">°C&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_thermal_management</span><span class="p">()</span>

                    <span class="c1"># Check memory usage</span>
                    <span class="k">if</span> <span class="n">current_info</span><span class="o">.</span><span class="n">memory_usage</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_threshold</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ High memory usage: </span><span class="si">{</span><span class="n">current_info</span><span class="o">.</span><span class="n">memory_usage</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_memory_cleanup</span><span class="p">()</span>

                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Monitor every 30 seconds</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monitoring error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">monitor_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">monitor</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">monitor_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_thermal_management</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle thermal throttling&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Reduce GPU frequency if possible</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;sudo&#39;</span><span class="p">,</span> <span class="s1">&#39;jetson_clocks&#39;</span><span class="p">,</span> <span class="s1">&#39;--restore&#39;</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Force garbage collection</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Applied thermal management measures&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thermal management error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_memory_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform memory cleanup&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Python garbage collection</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

            <span class="c1"># PyTorch cache cleanup</span>
            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performed memory cleanup&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory cleanup error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_performance_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate performance report&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;No performance data available&quot;</span><span class="p">}</span>

        <span class="n">recent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance_history</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>  <span class="c1"># Last 10 entries</span>

        <span class="n">avg_cpu</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;cpu_usage&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">recent_data</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_data</span><span class="p">)</span>
        <span class="n">avg_memory</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;memory_usage&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">recent_data</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_data</span><span class="p">)</span>
        <span class="n">avg_temp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">recent_data</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;system_info&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">,</span>
            <span class="s2">&quot;average_cpu_usage&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_cpu</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
            <span class="s2">&quot;average_memory_usage&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_memory</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;average_temperature&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_temp</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">°C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;optimization_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization_settings</span><span class="p">,</span>
            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recommendations</span><span class="p">(</span><span class="n">avg_cpu</span><span class="p">,</span> <span class="n">avg_memory</span><span class="p">,</span> <span class="n">avg_temp</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpu_usage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">memory_usage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get optimization recommendations&quot;&quot;&quot;</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">cpu_usage</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Consider reducing batch sizes or using fewer concurrent workers&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">memory_usage</span> <span class="o">&gt;</span> <span class="mf">0.85</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Enable more aggressive memory cleanup or reduce model size&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">temperature</span> <span class="o">&gt;</span> <span class="mi">75</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Improve cooling or reduce computational load&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">recommendations</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;System performance is optimal&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">recommendations</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OptimizedJetsonAgent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AI Agent optimized for Jetson performance&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">memory_manager</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">:</span> <span class="n">JetsonOptimizer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="n">memory_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="p">{</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tool</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span>
            <span class="n">max_workers</span><span class="o">=</span><span class="n">optimizer</span><span class="o">.</span><span class="n">optimization_settings</span><span class="p">[</span><span class="s1">&#39;max_workers&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Apply optimizations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">optimize_torch_settings</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_query_optimized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process query with Jetson optimizations&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check system resources before processing</span>
            <span class="n">current_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">get_system_info</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">current_info</span><span class="o">.</span><span class="n">memory_usage</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">_memory_cleanup</span><span class="p">()</span>
                <span class="k">return</span> <span class="s2">&quot;System memory is critically low. Please try again in a moment.&quot;</span>

            <span class="k">if</span> <span class="n">current_info</span><span class="o">.</span><span class="n">temperature</span> <span class="o">&gt;</span> <span class="mi">85</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;System temperature is too high. Please allow cooling before continuing.&quot;</span>

            <span class="c1"># Get memory context (optimized)</span>
            <span class="n">memory_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">get_context_for_query</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span> <span class="n">max_context_length</span><span class="o">=</span><span class="mi">1000</span>  <span class="c1"># Reduced for Jetson</span>
            <span class="p">)</span>

            <span class="c1"># Process with resource-aware batching</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_with_batching</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">memory_context</span><span class="p">)</span>

            <span class="c1"># Update memory asynchronously</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">update_conversation_memory</span><span class="p">,</span>
                <span class="n">query</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">session_id</span>
            <span class="p">)</span>

            <span class="n">processing_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query processed in </span><span class="si">{</span><span class="n">processing_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">response</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error processing query: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_with_batching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process query with optimized batching&quot;&quot;&quot;</span>
        <span class="c1"># Simplified prompt for better performance</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Context: </span><span class="si">{</span><span class="n">context</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="se">\n\n</span><span class="s2">Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Response:&quot;</span>

        <span class="c1"># Use optimized inference settings</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">inference_mode</span><span class="p">():</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_system_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive system status&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">get_performance_report</span><span class="p">()</span>

<span class="c1"># Usage example</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">JetsonOptimizer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detected: </span><span class="si">{</span><span class="n">optimizer</span><span class="o">.</span><span class="n">system_info</span><span class="o">.</span><span class="n">jetson_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimization settings: </span><span class="si">{</span><span class="n">optimizer</span><span class="o">.</span><span class="n">optimization_settings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create optimized agent</span>
<span class="n">optimized_agent</span> <span class="o">=</span> <span class="n">OptimizedJetsonAgent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">memory_manager</span><span class="o">=</span><span class="n">memory_manager</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">all_tools</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span>
<span class="p">)</span>

<span class="c1"># Test optimized processing</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">optimized_agent</span><span class="o">.</span><span class="n">process_query_optimized</span><span class="p">(</span>
    <span class="s2">&quot;What are the best practices for optimizing AI models on Jetson?&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># Get system status</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">optimized_agent</span><span class="o">.</span><span class="n">get_system_status</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">System Status:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">status</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="hardware-acceleration-utilities">🔧 Hardware Acceleration Utilities<a class="headerlink" href="#hardware-acceleration-utilities" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">JetsonAccelerationUtils</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Utilities for hardware acceleration on Jetson&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">optimize_embedding_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fp16&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optimize embedding model for Jetson&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">sentence_transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">SentenceTransformer</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

            <span class="c1"># Load model</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

            <span class="c1"># Move to GPU if available</span>
            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>

                <span class="c1"># Apply precision optimization</span>
                <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s2">&quot;fp16&quot;</span><span class="p">:</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">half</span><span class="p">()</span>

                <span class="c1"># Optimize for inference</span>
                <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

                <span class="c1"># Compile model for better performance (PyTorch 2.0+)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># Fallback if compile not available</span>

            <span class="k">return</span> <span class="n">model</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model optimization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_tensorrt_engine</span><span class="p">(</span><span class="n">model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create TensorRT engine for model acceleration&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">tensorrt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">trt</span>

            <span class="c1"># This is a simplified example</span>
            <span class="c1"># In practice, you&#39;d need to convert your specific model</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating TensorRT engine for </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input shape: </span><span class="si">{</span><span class="n">input_shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># TensorRT optimization would go here</span>
            <span class="c1"># Return path to optimized engine</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">.trt&quot;</span>

        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TensorRT not available&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TensorRT optimization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">benchmark_inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sample_input</span><span class="p">,</span> <span class="n">num_runs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Benchmark model inference performance&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

        <span class="c1"># Warmup</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>

        <span class="c1"># Benchmark</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_runs</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">sample_input</span><span class="p">)</span>

        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">avg_time</span> <span class="o">=</span> <span class="n">total_time</span> <span class="o">/</span> <span class="n">num_runs</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="n">num_runs</span> <span class="o">/</span> <span class="n">total_time</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;average_latency_ms&quot;</span><span class="p">:</span> <span class="n">avg_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s2">&quot;throughput_fps&quot;</span><span class="p">:</span> <span class="n">throughput</span><span class="p">,</span>
            <span class="s2">&quot;total_time_s&quot;</span><span class="p">:</span> <span class="n">total_time</span>
        <span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="model-context-protocol-mcp-integration">🔌 Model Context Protocol (MCP) Integration<a class="headerlink" href="#model-context-protocol-mcp-integration" title="Permanent link">&para;</a></h2>
<h3 id="introduction-to-mcp">📋 Introduction to MCP<a class="headerlink" href="#introduction-to-mcp" title="Permanent link">&para;</a></h3>
<p>Model Context Protocol (MCP) is an open standard for connecting AI assistants to data sources and tools. It provides a standardized way to integrate external resources with language models.</p>
<p><strong>Key MCP Benefits:</strong>
- <strong>Standardized Integration</strong>: Universal protocol for connecting tools and data sources
- <strong>Security</strong>: Controlled access to resources with proper authentication
- <strong>Extensibility</strong>: Easy to add new tools and data sources
- <strong>Interoperability</strong>: Works across different AI platforms and models
- <strong>Local Control</strong>: Perfect for edge AI applications on Jetson</p>
<h3 id="mcp-architecture-for-jetson">🏗️ MCP Architecture for Jetson<a class="headerlink" href="#mcp-architecture-for-jetson" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>graph TB
    subgraph &quot;Jetson Device&quot;
        subgraph &quot;MCP Client&quot;
            A[AI Agent] --&gt; B[MCP Client]
            B --&gt; C[Protocol Handler]
        end

        subgraph &quot;MCP Servers&quot;
            D[Document Server]
            E[Web Search Server]
            F[System Monitor Server]
            G[File System Server]
        end

        subgraph &quot;Local Resources&quot;
            H[PDF Documents]
            I[Vector Database]
            J[System Metrics]
            K[Local Files]
        end
    end

    subgraph &quot;External Resources&quot;
        L[Web APIs]
        M[Online Databases]
    end

    C --&gt; D
    C --&gt; E
    C --&gt; F
    C --&gt; G

    D --&gt; H
    D --&gt; I
    E --&gt; L
    F --&gt; J
    G --&gt; K
    E --&gt; M
</code></pre></div>
<h3 id="building-mcp-servers-for-jetson">🛠️ Building MCP Servers for Jetson<a class="headerlink" href="#building-mcp-servers-for-jetson" title="Permanent link">&para;</a></h3>
<h4 id="document-processing-mcp-server">Document Processing MCP Server<a class="headerlink" href="#document-processing-mcp-server" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiofiles</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Server</span><span class="p">,</span> <span class="n">types</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">stdio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span><span class="p">,</span> <span class="n">TextContent</span><span class="p">,</span> <span class="n">ImageContent</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MCPDocumentServer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MCP Server for document processing on Jetson&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_processor</span><span class="p">,</span> <span class="n">vector_store_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span> <span class="o">=</span> <span class="n">document_processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store_path</span> <span class="o">=</span> <span class="n">vector_store_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;jetson-document-server&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_tools</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup MCP tools for document operations&quot;&quot;&quot;</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">list_tools</span><span class="p">()</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_tools</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">Tool</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;search_documents&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search through local documents using semantic similarity&quot;</span><span class="p">,</span>
                    <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Search query for documents&quot;</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;max_results&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum number of results to return&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">5</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;similarity_threshold&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Minimum similarity score (0-1)&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mf">0.7</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">),</span>
                <span class="n">Tool</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;add_document&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Add a new document to the knowledge base&quot;</span><span class="p">,</span>
                    <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to the document file&quot;</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Additional metadata for the document&quot;</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">),</span>
                <span class="n">Tool</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;list_documents&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List all documents in the knowledge base&quot;</span><span class="p">,</span>
                    <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Filter by document category&quot;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">),</span>
                <span class="n">Tool</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;get_document_summary&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Get summary of a specific document&quot;</span><span class="p">,</span>
                    <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;document_id&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;ID of the document&quot;</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;document_id&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">call_tool</span><span class="p">()</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_tool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Handle tool calls&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;search_documents&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_documents</span><span class="p">(</span>
                    <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">],</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_results&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;similarity_threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;add_document&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_document</span><span class="p">(</span>
                    <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">],</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;list_documents&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_documents</span><span class="p">(</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;get_document_summary&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_document_summary</span><span class="p">(</span>
                    <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;document_id&quot;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown tool: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_search_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search documents using the document processor&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load vector store</span>
            <span class="n">vector_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span><span class="o">.</span><span class="n">load_vector_store</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_store_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">vector_store</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No documents found in the knowledge base. Please add documents first.&quot;</span>
                <span class="p">)]</span>

            <span class="c1"># Perform search</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">vector_store</span><span class="o">.</span><span class="n">similarity_search_with_score</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>

            <span class="c1"># Filter by threshold</span>
            <span class="n">filtered_results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">doc</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_results</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No documents found matching &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39; with similarity &gt;= </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)]</span>

            <span class="c1"># Format results</span>
            <span class="n">response_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents matching &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;:</span><span class="se">\n\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filtered_results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. **Score: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Source: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Content: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">...</span><span class="se">\n\n</span><span class="s2">&quot;</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">response_text</span><span class="p">)]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error searching documents: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_add_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new document to the knowledge base&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if file exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)]</span>

            <span class="c1"># Process document</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span><span class="o">.</span><span class="n">process_document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">documents</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to process document: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)]</span>

            <span class="c1"># Add metadata</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;added_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># Update vector store</span>
            <span class="n">vector_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span><span class="o">.</span><span class="n">load_vector_store</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_store_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vector_store</span><span class="p">:</span>
                <span class="n">vector_store</span><span class="o">.</span><span class="n">add_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vector_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span><span class="o">.</span><span class="n">build_vector_store</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

            <span class="c1"># Save updated vector store</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span><span class="o">.</span><span class="n">save_vector_store</span><span class="p">(</span><span class="n">vector_store</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store_path</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Successfully added </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> to the knowledge base.&quot;</span>
            <span class="p">)]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error adding document: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_list_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all documents in the knowledge base&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vector_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_processor</span><span class="o">.</span><span class="n">load_vector_store</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_store_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">vector_store</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;No documents in the knowledge base.&quot;</span>
                <span class="p">)]</span>

            <span class="c1"># Get all documents (this is a simplified approach)</span>
            <span class="c1"># In practice, you&#39;d want to maintain a separate index</span>
            <span class="n">all_docs</span> <span class="o">=</span> <span class="n">vector_store</span><span class="o">.</span><span class="n">similarity_search</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Get many docs</span>

            <span class="c1"># Extract unique sources</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">all_docs</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
                    <span class="n">sources</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">sources</span><span class="p">:</span>
                <span class="n">filter_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; in category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="n">category</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No documents found</span><span class="si">{</span><span class="n">filter_text</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)]</span>

            <span class="n">response_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Documents in knowledge base</span><span class="si">{</span><span class="s1">&#39; (category: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sources</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">response_text</span><span class="p">)]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error listing documents: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_document_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get summary of a specific document&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># This is a simplified implementation</span>
            <span class="c1"># In practice, you&#39;d maintain document metadata separately</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Document summary for </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> would be implemented here.&quot;</span>
            <span class="p">)]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error getting document summary: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)]</span>

<span class="c1"># Web Search MCP Server</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MCPWebSearchServer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MCP Server for web search functionality&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">web_search_tool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_search_tool</span> <span class="o">=</span> <span class="n">web_search_tool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="s2">&quot;jetson-web-search-server&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_tools</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup MCP tools for web search&quot;&quot;&quot;</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">list_tools</span><span class="p">()</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_tools</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">Tool</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;web_search&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Search the web for information&quot;</span><span class="p">,</span>
                    <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Search query&quot;</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;max_results&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum number of results&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">5</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;search_engine&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Search engine to use&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;enum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;google&quot;</span><span class="p">,</span> <span class="s2">&quot;duckduckgo&quot;</span><span class="p">],</span>
                                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;duckduckgo&quot;</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">),</span>
                <span class="n">Tool</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;extract_webpage&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extract and summarize content from a webpage&quot;</span><span class="p">,</span>
                    <span class="n">inputSchema</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;URL of the webpage to extract&quot;</span>
                            <span class="p">},</span>
                            <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum length of extracted content&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">1000</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">call_tool</span><span class="p">()</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_tool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Handle tool calls&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;web_search&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_web_search</span><span class="p">(</span>
                    <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">],</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_results&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;search_engine&quot;</span><span class="p">,</span> <span class="s2">&quot;duckduckgo&quot;</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;extract_webpage&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_webpage</span><span class="p">(</span>
                    <span class="n">arguments</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
                    <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_length&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown tool: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_web_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">search_engine</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform web search&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_search_tool</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">max_results</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No results found for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="p">)]</span>

            <span class="n">response_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Web search results for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;:</span><span class="se">\n\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. **</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No title&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   URL: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No URL&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">response_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Snippet: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;snippet&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No snippet&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">response_text</span><span class="p">)]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error performing web search: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_extract_webpage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TextContent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract content from webpage&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_search_tool</span><span class="o">.</span><span class="n">extract_content</span><span class="p">,</span> <span class="n">url</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to extract content from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)]</span>

            <span class="c1"># Truncate if too long</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[:</span><span class="n">max_length</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>

            <span class="n">response_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Content extracted from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">response_text</span><span class="p">)]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">TextContent</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error extracting webpage content: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)]</span>
</code></pre></div>
<h3 id="mcp-based-ai-agent">🤖 MCP-Based AI Agent<a class="headerlink" href="#mcp-based-ai-agent" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">stdio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MCPJetsonAgent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AI Agent using MCP for tool integration&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_clients</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Initialize MCP clients</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_initialize_mcp_clients</span><span class="p">(</span><span class="n">mcp_servers</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_mcp_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_commands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MCP client connections&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">server_command</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">server_commands</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Create stdio client for each server</span>
                <span class="n">client_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;server_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># In practice, you&#39;d start the server process and connect</span>
                <span class="c1"># This is a simplified example</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to MCP server: </span><span class="si">{</span><span class="n">server_command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Store client reference</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mcp_clients</span><span class="p">[</span><span class="n">client_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="n">server_command</span><span class="p">,</span>
                    <span class="s1">&#39;connected&#39;</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">}</span>

                <span class="c1"># Get available tools from this server</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_tools_from_server</span><span class="p">(</span><span class="n">client_name</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to MCP server </span><span class="si">{</span><span class="n">server_command</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_load_tools_from_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load available tools from an MCP server&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># In practice, you&#39;d call the actual MCP client</span>
            <span class="c1"># This is a mock implementation</span>

            <span class="k">if</span> <span class="s2">&quot;document&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_clients</span><span class="p">[</span><span class="n">client_name</span><span class="p">][</span><span class="s1">&#39;command&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s1">&#39;search_documents&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">client_name</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Search through local documents&#39;</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;add_document&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">client_name</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Add document to knowledge base&#39;</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;list_documents&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">client_name</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;List all documents&#39;</span>
                    <span class="p">}</span>
                <span class="p">})</span>

            <span class="k">elif</span> <span class="s2">&quot;web&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_clients</span><span class="p">[</span><span class="n">client_name</span><span class="p">][</span><span class="s1">&#39;command&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s1">&#39;web_search&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">client_name</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Search the web&#39;</span>
                    <span class="p">},</span>
                    <span class="s1">&#39;extract_webpage&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">client_name</span><span class="p">,</span>
                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Extract webpage content&#39;</span>
                    <span class="p">}</span>
                <span class="p">})</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded tools from </span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading tools from </span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process user query using MCP tools&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Analyze query to determine needed tools</span>
            <span class="n">needed_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_query_for_tools</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Execute tools if needed</span>
            <span class="n">tool_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_args</span> <span class="ow">in</span> <span class="n">needed_tools</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tool_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_mcp_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_args</span><span class="p">)</span>
                    <span class="n">tool_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Combine results with LLM</span>
            <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tool_results</span><span class="p">)</span> <span class="k">if</span> <span class="n">tool_results</span> <span class="k">else</span> <span class="s2">&quot;No additional context needed.&quot;</span>

            <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">User Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>

<span class="s2">Available Tools: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span>

<span class="s2">Tool Results:</span>
<span class="si">{</span><span class="n">context</span><span class="si">}</span>

<span class="s2">Please provide a comprehensive response based on the query and any tool results.</span>
<span class="s2">&quot;&quot;&quot;</span>

            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">,</span> <span class="n">prompt</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">response</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error processing query: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_query_for_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze query to determine which tools to use&quot;&quot;&quot;</span>
        <span class="n">tools_to_use</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query_lower</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Simple keyword-based tool selection</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="s1">&#39;find&#39;</span><span class="p">,</span> <span class="s1">&#39;document&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">]):</span>
            <span class="c1"># Extract search terms (simplified)</span>
            <span class="n">search_terms</span> <span class="o">=</span> <span class="n">query</span>  <span class="c1"># In practice, you&#39;d extract key terms</span>
            <span class="n">tools_to_use</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;search_documents&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">search_terms</span><span class="p">}))</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="s1">&#39;internet&#39;</span><span class="p">,</span> <span class="s1">&#39;latest&#39;</span><span class="p">]):</span>
            <span class="n">tools_to_use</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;web_search&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">}))</span>

        <span class="k">if</span> <span class="s1">&#39;add&#39;</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">query_lower</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;document&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">]):</span>
            <span class="c1"># This would need more sophisticated parsing</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">tools_to_use</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_execute_mcp_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tool_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute an MCP tool&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tool_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
            <span class="n">server_name</span> <span class="o">=</span> <span class="n">tool_info</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>

            <span class="c1"># In practice, you&#39;d call the actual MCP client</span>
            <span class="c1"># This is a mock implementation</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2"> with args: </span><span class="si">{</span><span class="n">tool_args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Mock responses based on tool type</span>
            <span class="k">if</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;search_documents&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Found 3 documents related to &#39;</span><span class="si">{</span><span class="n">tool_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;web_search&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Found 5 web results for &#39;</span><span class="si">{</span><span class="n">tool_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="k">elif</span> <span class="n">tool_name</span> <span class="o">==</span> <span class="s1">&#39;extract_webpage&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Extracted content from </span><span class="si">{</span><span class="n">tool_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Executed </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2"> successfully&quot;</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error executing </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available tools&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_tools</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_mcp_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_command</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new MCP server at runtime&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_mcp_clients</span><span class="p">([</span><span class="n">server_command</span><span class="p">])</span>

<span class="c1"># Usage Example</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Initialize MCP-based agent</span>
    <span class="n">mcp_servers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;python document_server.py&quot;</span><span class="p">,</span>
        <span class="s2">&quot;python web_search_server.py&quot;</span>
    <span class="p">]</span>

    <span class="n">agent</span> <span class="o">=</span> <span class="n">MCPJetsonAgent</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="o">=</span><span class="n">mcp_servers</span><span class="p">)</span>

    <span class="c1"># Wait for initialization</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Test queries</span>
    <span class="n">queries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Search for documents about machine learning&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Find the latest news about NVIDIA Jetson&quot;</span><span class="p">,</span>
        <span class="s2">&quot;What are the best practices for edge AI?&quot;</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">process_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Available tools: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">get_available_tools</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Run the example</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h3 id="mcp-vs-langchain-comparison">🔄 MCP vs LangChain Comparison<a class="headerlink" href="#mcp-vs-langchain-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>LangChain Approach</th>
<th>MCP Approach</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tool Integration</strong></td>
<td>Direct Python imports</td>
<td>Standardized protocol</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Monolithic agent</td>
<td>Distributed servers</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>Process-level</td>
<td>Protocol-level isolation</td>
</tr>
<tr>
<td><strong>Interoperability</strong></td>
<td>Python-specific</td>
<td>Language agnostic</td>
</tr>
<tr>
<td><strong>Development</strong></td>
<td>Single codebase</td>
<td>Modular servers</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Direct calls</td>
<td>Network overhead</td>
</tr>
<tr>
<td><strong>Maintenance</strong></td>
<td>Coupled updates</td>
<td>Independent updates</td>
</tr>
<tr>
<td><strong>Resource Usage</strong></td>
<td>Single process</td>
<td>Multiple processes</td>
</tr>
</tbody>
</table>
<h3 id="deployment-on-jetson">🚀 Deployment on Jetson<a class="headerlink" href="#deployment-on-jetson" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install MCP dependencies</span>
pip<span class="w"> </span>install<span class="w"> </span>mcp

<span class="c1"># Start document server</span>
python<span class="w"> </span>document_mcp_server.py<span class="w"> </span><span class="p">&amp;</span>

<span class="c1"># Start web search server</span>
python<span class="w"> </span>web_search_mcp_server.py<span class="w"> </span><span class="p">&amp;</span>

<span class="c1"># Start main agent</span>
python<span class="w"> </span>mcp_jetson_agent.py
</code></pre></div>
<h3 id="performance-comparison">📊 Performance Comparison<a class="headerlink" href="#performance-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>LangChain Agent</th>
<th>MCP Agent</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Startup Time</strong></td>
<td>2-3 seconds</td>
<td>5-7 seconds</td>
</tr>
<tr>
<td><strong>Memory Usage</strong></td>
<td>1.2 GB</td>
<td>1.8 GB</td>
</tr>
<tr>
<td><strong>Query Latency</strong></td>
<td>0.5-1.0s</td>
<td>0.8-1.5s</td>
</tr>
<tr>
<td><strong>Modularity</strong></td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td><strong>Fault Tolerance</strong></td>
<td>Low</td>
<td>High</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Medium</td>
<td>High</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="function-calling-support-tool-use-via-json">🤝 Function Calling Support (Tool Use via JSON)<a class="headerlink" href="#function-calling-support-tool-use-via-json" title="Permanent link">&para;</a></h2>
<p>Function calling enables structured tool invocation from LLMs using JSON schema.</p>
<h3 id="why-its-useful">Why it's useful:<a class="headerlink" href="#why-its-useful" title="Permanent link">&para;</a></h3>
<ul>
<li>Enables precision in tool execution</li>
<li>Easy to parse and extend with APIs</li>
<li>Supported by OpenAI, Ollama (some models), and LangChain</li>
</ul>
<p>LangChain integrates this using the ReActAgent + Tool definitions.</p>
<hr />
<h2 id="what-is-mcp-multi-component-prompting">🧰 What is MCP (Multi-Component Prompting)?<a class="headerlink" href="#what-is-mcp-multi-component-prompting" title="Permanent link">&para;</a></h2>
<p>MCP involves splitting prompts into parts to:</p>
<ul>
<li>Improve performance on edge LLMs</li>
<li>Isolate tool planning from reasoning</li>
<li>Modularize prompt templates</li>
</ul>
<p>Useful when chaining reasoning across multiple tools or responses.</p>
<hr />
<h2 id="agent-tools">🔌 Agent Tools<a class="headerlink" href="#agent-tools" title="Permanent link">&para;</a></h2>
<p>LangChain provides many tools for agents:</p>
<ul>
<li><code>Python REPL</code> (math, logic, data)</li>
<li><code>File system access</code></li>
<li><code>Search/QA</code></li>
<li><code>Terminal commands</code> (⚠️ safe usage required)</li>
</ul>
<hr />
<h2 id="agent-types-langchain">🚀 Agent Types (LangChain)<a class="headerlink" href="#agent-types-langchain" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>ZeroShotAgent</strong>: Selects tools via LLM</li>
<li><strong>ReActAgent</strong>: Combines reasoning and acting</li>
<li><strong>Toolkits</strong>: Bundled tools for DevOps, CSV, web</li>
</ul>
<hr />
<h2 id="lab-local-langchain-agent-with-llamacpp-or-ollama">🧪 Lab: Local LangChain Agent with llama.cpp or Ollama<a class="headerlink" href="#lab-local-langchain-agent-with-llamacpp-or-ollama" title="Permanent link">&para;</a></h2>
<h3 id="setup">🧰 Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>langchain<span class="w"> </span>llama-cpp-python
</code></pre></div>
<hr />
<h3 id="llamacpp-backend">✅ llama.cpp Backend<a class="headerlink" href="#llamacpp-backend" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">PythonREPLTool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">initialize_agent</span><span class="p">,</span> <span class="n">AgentType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.llms</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlamaCpp</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">LlamaCpp</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;/models/mistral.gguf&quot;</span><span class="p">,</span> <span class="n">n_gpu_layers</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">PythonREPLTool</span><span class="p">()]</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">initialize_agent</span><span class="p">(</span><span class="n">tools</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="n">AgentType</span><span class="o">.</span><span class="n">ZERO_SHOT_REACT_DESCRIPTION</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;What is 12 squared minus 3?&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="ollama-backend-openai-compatible-api">✅ Ollama Backend (OpenAI-compatible API)<a class="headerlink" href="#ollama-backend-openai-compatible-api" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.llms</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">initialize_agent</span><span class="p">,</span> <span class="n">AgentType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">PythonREPLTool</span>

<span class="n">ollama_llm</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;http://localhost:11434/v1&quot;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;ollama&quot;</span><span class="p">)</span>
<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">PythonREPLTool</span><span class="p">()]</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">initialize_agent</span><span class="p">(</span><span class="n">tools</span><span class="p">,</span> <span class="n">ollama_llm</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="n">AgentType</span><span class="o">.</span><span class="n">ZERO_SHOT_REACT_DESCRIPTION</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Solve 2^6 and explain.&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="bonus-add-filesystem-tool">🧪 Bonus: Add Filesystem Tool<a class="headerlink" href="#bonus-add-filesystem-tool" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">def</span><span class="w"> </span><span class="nf">list_files</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;./&quot;</span><span class="p">))</span>

<span class="n">fs_tool</span> <span class="o">=</span> <span class="n">Tool</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;List Files&quot;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">list_files</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;List files in current directory&quot;</span><span class="p">)</span>
<span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs_tool</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="lab-deliverables">📋 Lab Deliverables<a class="headerlink" href="#lab-deliverables" title="Permanent link">&para;</a></h2>
<ul>
<li>Implement local agent using llama.cpp and/or Ollama</li>
<li>Add at least 2 tools (Python + custom tool)</li>
<li>Demonstrate tool use, function call-like behavior, and multi-turn reasoning</li>
</ul>
<hr />
<h2 id="summary">🧠 Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<ul>
<li>Agents = LLM + memory + tools</li>
<li>LangChain agents support both llama-cpp-python and Ollama with GGUF models</li>
<li>Use structured tool calling and MCP to improve modularity and performance</li>
<li>Jetson Orin Nano can run lightweight agents entirely offline</li>
</ul>
<p>→ Next: <a href="11_final_challenges_hackathon.md">Final Project: Hackathon &amp; Challenges</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>